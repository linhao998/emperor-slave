(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();function e(){let e=document.createElement(`div`);return e.className=`app-root`,e}function t(e,t){e.innerHTML=``;let n=document.createElement(`h1`);n.textContent=`Emperor-Slave Game`;let r=document.createElement(`div`);r.className=`home-actions`;let i=document.createElement(`button`);i.type=`button`,i.textContent=`开始游戏`,i.addEventListener(`click`,()=>{t(`start`)});let a=document.createElement(`button`);a.type=`button`,a.textContent=`新手引导`,a.addEventListener(`click`,()=>{t(`guide`),y()});let o=document.createElement(`button`);o.type=`button`,o.textContent=`退出游戏`,o.addEventListener(`click`,()=>{t(`exit`),x()}),r.append(i,a,o);let s=document.createElement(`div`);s.className=`home-version`,s.textContent=`版本号：v0.2`;let c=document.createElement(`div`);c.className=`home-hint`,c.textContent=`请横屏或全屏以获得最佳体验`;let l=document.createElement(`div`);l.className=`guide-modal`,l.setAttribute(`aria-hidden`,`true`);let u=document.createElement(`div`);u.className=`guide-content`;let d=document.createElement(`div`);d.className=`guide-body`,d.textContent=`① 游戏简介
欢迎来到 Emperor–Slave Game 
这是一款基于心理博弈的卡牌游戏。你需要在有限的信息下，选择合适的卡牌，与系统进行对抗。

② 卡牌介绍：
皇帝（Emperor）：地位最高的卡牌，可以战胜平民，但会被奴隶击败。
平民（Citizen）：最普通的卡牌，与其他平民对战时平局，可以击败奴隶，被皇帝击败。
奴隶（Slave）：地位最低，但拥有特殊能力，可以击败皇帝，但会被平民击败。

③ 胜负规则
胜负关系如下：
皇帝 > 平民
奴隶 > 皇帝
平民 > 奴隶

④ 游戏流程
选择一张卡牌 > 再次点击出牌 > 系统同时出牌并判定胜负 > 查看结果，进入下一回合或结束游戏。

⑤ 提示
系统不会固定出牌模式。观察结果、调整策略，才是获胜的关键。

准备好了吗？
点击「开始游戏」进入第一局。`;let f=document.createElement(`button`);f.type=`button`,f.className=`guide-close`,f.textContent=`我知道了`,f.addEventListener(`click`,()=>{b()}),u.append(d),l.append(u,f);let p=document.createElement(`div`);p.className=`exit-modal`,p.setAttribute(`aria-hidden`,`true`);let m=document.createElement(`div`);m.className=`exit-dialog`;let h=document.createElement(`div`);h.className=`exit-title`,h.textContent=`确定退出游戏吗？`;let g=document.createElement(`div`);g.className=`exit-actions`;let _=document.createElement(`button`);_.type=`button`,_.className=`exit-button`,_.textContent=`返回游戏`,_.addEventListener(`click`,()=>{S()});let v=document.createElement(`button`);v.type=`button`,v.className=`exit-button`,v.textContent=`退出游戏`,v.addEventListener(`click`,()=>{alert(`exit game`)}),g.append(_,v),m.append(h,g),p.appendChild(m),e.append(n,r,s,c,l,p);function y(){l.classList.add(`is-visible`),l.setAttribute(`aria-hidden`,`false`)}function b(){l.classList.remove(`is-visible`),l.setAttribute(`aria-hidden`,`true`)}function x(){p.classList.add(`is-visible`),p.setAttribute(`aria-hidden`,`false`)}function S(){p.classList.remove(`is-visible`),p.setAttribute(`aria-hidden`,`true`)}}let n=function(e){return e.Emperor=`Emperor`,e.Citizen=`Citizen`,e.Slave=`Slave`,e}({}),r=function(e){return e.PlayerWin=`PlayerWin`,e.AIWin=`AIWin`,e.Draw=`Draw`,e}({});function i(e,t){return e===t?r.Draw:e===n.Emperor&&t===n.Citizen||e===n.Citizen&&t===n.Slave||e===n.Slave&&t===n.Emperor?r.PlayerWin:e===n.Citizen&&t===n.Emperor||e===n.Slave&&t===n.Citizen||e===n.Emperor&&t===n.Slave?r.AIWin:r.Draw}var a=function(e){return e.Selecting=`Selecting`,e.Confirmed=`Confirmed`,e.Resolving=`Resolving`,e.ResultAnimating=`ResultAnimating`,e.ResultReady=`ResultReady`,e}(a||{});function o(e,t){e.innerHTML=``;let o=document.createElement(`div`);o.className=`game-screen`;let s=document.createElement(`div`);s.className=`ai-hand`;let c=[],l=[],u=[25,170,315,460,600];u.forEach((e,t)=>{let n=document.createElement(`div`);n.className=`card ai-card`,n.style.left=`${e}px`,n.style.top=`25px`,n.textContent=`back`,n.setAttribute(`data-index`,String(t)),s.appendChild(n),l.push(n)});let d=document.createElement(`div`);d.className=`battle-area`;let f={ai:{left:670,top:193},player:{left:670,top:413}},p=document.createElement(`div`);p.className=`card battle-card is-hidden`,p.style.left=`${f.ai.left}px`,p.style.top=`${f.ai.top}px`,p.textContent=``;let m=document.createElement(`div`);m.className=`card battle-card is-hidden`,m.style.left=`${f.player.left}px`,m.style.top=`${f.player.top}px`,m.textContent=``;let h=document.createElement(`div`);h.className=`battle-result`,d.append(p,m,h);let g=document.createElement(`div`);g.className=`player-hand`;let _=[],v=[{left:720,cardId:`P-E`},{left:865,cardId:`P-S`},{left:1010,cardId:`P-C1`},{left:1155,cardId:`P-C2`},{left:1295,cardId:`P-C3`}],y=v.map(e=>({left:e.left,top:595})),b={},x=[],S=new Map;v.forEach((e,t)=>{b[e.cardId]=t;let n=document.createElement(`div`);n.className=`card player-card`,n.style.left=`${e.left}px`,n.style.top=`595px`,n.textContent=``,n.setAttribute(`data-index`,String(t)),n.setAttribute(`data-card`,e.cardId),n.addEventListener(`click`,()=>{if(R!==a.Selecting)return;let t=J(e.cardId);if(!(!t||t.used)){if(B===t.id){z=t,K(a.Confirmed),K(a.Resolving);return}B=t.id,z=t,Q(),$()}}),n.addEventListener(`transitionend`,e=>{e.propertyName===`left`&&n.classList.remove(`is-shifting`)}),g.appendChild(n),x.push({element:n,cardId:e.cardId}),S.set(e.cardId,n)});let C=document.createElement(`div`);C.className=`control-area`;let w=document.createElement(`button`);w.type=`button`,w.className=`pause-button`,w.setAttribute(`aria-label`,`暂停`),w.innerHTML=`
    <svg aria-hidden="true" width="55" height="55" viewBox="0 0 55 55">
      <g transform="matrix(1 0 0 1 -1346 -20)">
        <path d="M 13.6962890625 3.68815104166666  C 17.9096137152778 1.22938368055555  22.5108506944444 0  27.5 0  C 32.4891493055556 0  37.0903862847222 1.22938368055555  41.3037109375 3.68815104166666  C 45.5170355902778 6.14691840277777  48.8530815972222 9.48296440972222  51.3118489583333 13.6962890625  C 53.7706163194444 17.9096137152778  55 22.5108506944444  55 27.5  C 55 32.4891493055556  53.7706163194444 37.0903862847222  51.3118489583333 41.3037109375  C 48.8530815972222 45.5170355902778  45.5170355902778 48.8530815972222  41.3037109375 51.3118489583333  C 37.0903862847222 53.7706163194445  32.4891493055556 55  27.5 55  C 22.5108506944444 55  17.9096137152778 53.7706163194445  13.6962890625 51.3118489583333  C 9.48296440972222 48.8530815972222  6.14691840277778 45.5170355902778  3.68815104166667 41.3037109375  C 1.22938368055556 37.0903862847222  0 32.4891493055556  0 27.5  C 0 22.5108506944444  1.22938368055556 17.9096137152778  3.68815104166667 13.6962890625  C 6.14691840277778 9.48296440972222  9.48296440972222 6.14691840277777  13.6962890625 3.68815104166666  Z M 17.724609375 44.365234375  C 20.7085503472222 46.1078559027778  23.9670138888889 46.9791666666667  27.5 46.9791666666667  C 31.0329861111111 46.9791666666667  34.2914496527778 46.1078559027778  37.275390625 44.365234375  C 40.2593315972222 42.6226128472222  42.6226128472222 40.2593315972222  44.365234375 37.275390625  C 46.1078559027778 34.2914496527778  46.9791666666667 31.0329861111111  46.9791666666667 27.5  C 46.9791666666667 23.9670138888889  46.1078559027778 20.7085503472222  44.365234375 17.724609375  C 42.6226128472222 14.7406684027778  40.2593315972222 12.3773871527778  37.275390625 10.634765625  C 34.2914496527778 8.89214409722222  31.0329861111111 8.02083333333334  27.5 8.02083333333334  C 23.9670138888889 8.02083333333334  20.7085503472222 8.89214409722222  17.724609375 10.634765625  C 14.7406684027778 12.3773871527778  12.3773871527778 14.7406684027778  10.634765625 17.724609375  C 8.89214409722222 20.7085503472222  8.02083333333333 23.9670138888889  8.02083333333333 27.5  C 8.02083333333333 31.0329861111111  8.89214409722222 34.2914496527778  10.634765625 37.275390625  C 12.3773871527778 40.2593315972222  14.7406684027778 42.6226128472222  17.724609375 44.365234375  Z M 37.8125 38.9583333333333  L 30.9375 38.9583333333333  C 30.6032986111111 38.9583333333333  30.3287760416667 38.8509114583333  30.1139322916667 38.6360677083333  C 29.8990885416667 38.4212239583333  29.7916666666667 38.1467013888889  29 37.8125  L 29 17.1875  C 29.7916666666667 16.8532986111111  29.8990885416667 16.5787760416667  30.1139322916667 16.3639322916667  C 30.3287760416667 16.1490885416667  30.6032986111111 16.0416666666667  30.9375 16.0416666666667  L 37.8125 16.0416666666667  C 38.1467013888889 16.0416666666667  38.4212239583333 16.1490885416667  38.6360677083333 16.3639322916667  C 38.8509114583333 16.5787760416667  38.9583333333333 16.8532986111111  39 17.1875  L 39 37.8125  C 38.9583333333333 38.1467013888889  38.8509114583333 38.4212239583333  38.6360677083333 38.6360677083333  C 38.4212239583333 38.8509114583333  38.1467013888889 38.9583333333333  37.8125 38.9583333333333  Z M 24.0625 38.9583333333333  L 17.1875 38.9583333333333  C 16.8532986111111 38.9583333333333  16.5787760416667 38.8509114583333  16.3639322916667 38.6360677083333  C 16.1490885416667 38.4212239583333  16.0416666666667 38.1467013888889  16 37.8125  L 16 17.1875  C 16.0416666666667 16.8532986111111  16.1490885416667 16.5787760416667  16.3639322916667 16.3639322916667  C 16.5787760416667 16.1490885416667  16.8532986111111 16.0416666666667  17.1875 16.0416666666667  L 24.0625 16.0416666666667  C 24.3967013888889 16.0416666666667  24.6712239583333 16.1490885416667  24.8860677083333 16.3639322916667  C 25.1009114583333 16.5787760416667  25.2083333333333 16.8532986111111  26 17.1875  L 26 37.8125  C 25.2083333333333 38.1467013888889  25.1009114583333 38.4212239583333  24.8860677083333 38.6360677083333  C 24.6712239583333 38.8509114583333  24.3967013888889 38.9583333333333  24.0625 38.9583333333333  Z " fill-rule="nonzero" fill="#ffffff" stroke="none" fill-opacity="0.9" transform="matrix(1 0 0 1 1346 20 )" />
      </g>
    </svg>
  `,w.addEventListener(`click`,()=>{ee()}),C.appendChild(w);let T=document.createElement(`div`);T.className=`pause-modal`,T.setAttribute(`aria-hidden`,`true`);let E=document.createElement(`div`);E.className=`pause-dialog`;let D=document.createElement(`div`);D.className=`pause-title`,D.textContent=`已暂停`;let O=document.createElement(`div`);O.className=`pause-actions`;let k=document.createElement(`button`);k.type=`button`,k.className=`pause-action`,k.textContent=`继续游戏`,k.addEventListener(`click`,()=>{q()});let A=document.createElement(`button`);A.type=`button`,A.className=`pause-action`,A.textContent=`重新开始`,A.addEventListener(`click`,()=>{q(),Y()});let j=document.createElement(`button`);j.type=`button`,j.className=`pause-action`,j.textContent=`返回首页`,j.addEventListener(`click`,()=>{q(),t.onExitToHome()}),O.append(k,A,j),E.append(D,O),T.appendChild(E);let M=document.createElement(`div`);M.className=`result-modal`,M.setAttribute(`aria-hidden`,`true`);let N=document.createElement(`div`);N.className=`result-dialog`;let P=document.createElement(`div`);P.className=`result-message`;let F=document.createElement(`div`);F.className=`result-actions`;let I=document.createElement(`button`);I.type=`button`,I.className=`result-button`,I.textContent=`再来一局`,I.addEventListener(`click`,()=>{Y()});let L=document.createElement(`button`);L.type=`button`,L.className=`result-button`,L.textContent=`回到主页`,L.addEventListener(`click`,()=>{Y(),t.onExitToHome()}),F.append(I,L),M.append(N,P,F),o.append(s,d,g,C,T,M),e.appendChild(o);let R=a.Selecting,z=null,B=null,V=null,H=null,U=0,W=!1;p.style.setProperty(`--battle-collision-offset`,`15px`),m.style.setProperty(`--battle-collision-offset`,`-15px`);let G=(e,t)=>{console.log(e,{from:R,to:t,playerCard:z?`${z.id}/${z.type}`:null,aiCard:V?`${V.id}/${V.type}`:null,matchResult:H})},K=e=>{if(G(`[GameState] before`,e),e===a.Resolving){if(!z||(U+=1,z.used=!0,V=ge(c),!V))return;V.used=!0,H=i(z.type,V.type),W=!1,R=a.ResultAnimating,$(),he(),G(`[GameState] after`,R);return}if(e===a.ResultReady){R=e,$(),H&&(P.textContent=_e(H)),G(`[GameState] after`,R);return}R=e,$(),G(`[GameState] after`,R)};Y();function ee(){T.classList.add(`is-visible`),T.setAttribute(`aria-hidden`,`false`)}function q(){T.classList.remove(`is-visible`),T.setAttribute(`aria-hidden`,`true`)}function te(){return[{id:`P-E`,type:n.Emperor,owner:`player`,used:!1},{id:`P-S`,type:n.Slave,owner:`player`,used:!1},{id:`P-C1`,type:n.Citizen,owner:`player`,used:!1},{id:`P-C2`,type:n.Citizen,owner:`player`,used:!1},{id:`P-C3`,type:n.Citizen,owner:`player`,used:!1}]}function ne(){return[{id:`A-C1`,type:n.Citizen,owner:`ai`,used:!1},{id:`A-C2`,type:n.Citizen,owner:`ai`,used:!1},{id:`A-C3`,type:n.Citizen,owner:`ai`,used:!1},{id:`A-E`,type:n.Emperor,owner:`ai`,used:!1},{id:`A-S`,type:n.Slave,owner:`ai`,used:!1}]}function J(e){return _.find(t=>t.id===e)??null}function re(){x.forEach(({element:e,cardId:t})=>{let n=J(t);n&&(e.textContent=n.type.toLowerCase(),e.setAttribute(`data-card`,n.id))}),l.forEach((e,t)=>{let n=c[t];n&&e.setAttribute(`data-card`,n.id)})}function Y(){_=te(),c=ne(),z=null,V=null,H=null,B=null,U=0,W=!1,R=a.Selecting,X(),ie(),ae(),P.textContent=``,re(),Q(),$()}function ie(){b={},v.forEach((e,t)=>{b[e.cardId]=t;let n=S.get(e.cardId);n&&(n.classList.remove(`is-used`,`is-shifting`),n.style.visibility=`visible`,n.style.left=`${y[t].left}px`,n.style.top=`${y[t].top}px`)})}function ae(){l.forEach((e,t)=>{e.classList.remove(`is-used`),e.style.visibility=`visible`,e.style.left=`${u[t]}px`,e.style.top=`25px`})}function oe(){z=null,B=null,V=null,H=null,W=!1,R=a.Selecting,P.textContent=``,Q(),$()}function X(){p.classList.add(`is-hidden`),m.classList.add(`is-hidden`),p.classList.remove(`is-back`,`enter`,`is-colliding`,`is-appearing`,`is-torn`),m.classList.remove(`enter`,`is-colliding`,`is-appearing`,`is-torn`),p.textContent=``,m.textContent=``,p.removeAttribute(`data-face`),m.removeAttribute(`data-face`),h.textContent=``,p.style.left=`${f.ai.left}px`,p.style.top=`${f.ai.top}px`,m.style.left=`${f.player.left}px`,m.style.top=`${f.player.top}px`}function Z(){if(W){p.classList.remove(`is-hidden`),m.classList.remove(`is-hidden`);return}p.classList.add(`is-hidden`),m.classList.add(`is-hidden`)}function se(){return new Promise(e=>{p.classList.add(`is-colliding`),m.classList.add(`is-colliding`),window.setTimeout(()=>{p.classList.remove(`is-colliding`),m.classList.remove(`is-colliding`),window.setTimeout(e,120)},220)})}function ce(e,t,n,r,i){let a=e.getBoundingClientRect(),o=t.getBoundingClientRect(),s=document.createElement(`div`);s.className=`flying-card`,r&&s.classList.add(`is-back`),i&&s.setAttribute(`data-face`,i),s.textContent=n,s.style.left=`${a.left}px`,s.style.top=`${a.top}px`,s.style.width=`${a.width}px`,s.style.height=`${a.height}px`,document.body.appendChild(s);let c=a.left+a.width/2,l=a.top+a.height/2,u=o.left+o.width/2,d=o.top+o.height/2,f=u-c,p=d-l,m,h=new Promise(e=>{m=e}),g=e=>{e.propertyName===`transform`&&(s.removeEventListener(`transitionend`,g),m())};return s.addEventListener(`transitionend`,g),{element:s,deltaX:f,deltaY:p,done:h,cleanup:()=>{s.removeEventListener(`transitionend`,g),s.remove()}}}function le(e){requestAnimationFrame(()=>{e.forEach(e=>{e.element.style.transform=`translate(${e.deltaX}px, ${e.deltaY}px)`})})}function ue(e){let t=S.get(e);t&&(t.classList.add(`is-used`),t.style.visibility=`hidden`)}function de(e){let t=l[e];t&&(t.classList.add(`is-used`),t.style.visibility=`hidden`)}function fe(){for(let e=l.length-1;e>=0;--e){let t=l[e];if(!(!t||t.classList.contains(`is-used`)))return e}return null}function pe(){Object.keys(b).forEach(e=>{let t=y[b[e]],n=S.get(e);!t||!n||(n.classList.add(`is-shifting`),n.style.left=`${t.left}px`,n.style.top=`${t.top}px`)})}function me(e){let t=b[e];t!==void 0&&(delete b[e],Object.keys(b).forEach(e=>{b[e]<t&&(b[e]+=1)}),pe())}function he(){if(!z||!V||!H)return;let e=z,t=V,n=H,i=U,o=S.get(e.id),s=fe();if(!o||s===null)return;let c=l[s];if(!c)return;let u=o.textContent??``;X();let d=ce(o,m,u,!1,e.type),f=ce(c,p,`back`,!0);ue(e.id),me(e.id),de(s),le([d,f]),Promise.all([d.done,f.done]).then(()=>{m.textContent=u,p.textContent=`back`,m.setAttribute(`data-face`,e.type),p.setAttribute(`data-face`,t.type),p.classList.add(`is-back`),m.classList.add(`is-appearing`),p.classList.add(`is-appearing`),W=!0,Z(),requestAnimationFrame(()=>{m.classList.remove(`is-appearing`),p.classList.remove(`is-appearing`)}),window.setTimeout(()=>{d.element.style.opacity=`0`,f.element.style.opacity=`0`,d.cleanup(),f.cleanup()},500),window.setTimeout(()=>{p.classList.remove(`is-back`),p.textContent=t.type,window.setTimeout(()=>{se().then(()=>{if(n===r.Draw&&i<5){window.setTimeout(()=>{W=!1,Z(),window.setTimeout(()=>{oe(),X()},300)},1e3);return}n===r.PlayerWin?p.classList.add(`is-torn`):n===r.AIWin&&m.classList.add(`is-torn`),requestAnimationFrame(()=>{window.setTimeout(()=>{K(a.ResultReady)},1300)})})},600)},1e3)})}function ge(e){let t=e.filter(e=>!e.used);return t.length===0?null:t[Math.floor(Math.random()*t.length)]}function Q(){x.forEach(({element:e,cardId:t})=>{e.classList.toggle(`is-selected`,B===t)})}function $(){g.classList.toggle(`is-locked`,R!==a.Selecting),d.classList.toggle(`show`,R===a.ResultAnimating),Z(),R===a.ResultReady?(M.classList.add(`is-visible`),M.setAttribute(`aria-hidden`,`false`)):(M.classList.remove(`is-visible`),M.setAttribute(`aria-hidden`,`true`))}function _e(e){return e===r.PlayerWin?`你赢了`:e===r.AIWin?`你输了`:`平局`}}var s=document.querySelector(`#app`);if(!s)throw Error(`App host element not found`);var c=e();s.appendChild(c);var l=1440,u=800,d=()=>window.visualViewport?{width:window.visualViewport.width,height:window.visualViewport.height}:{width:window.innerWidth,height:window.innerHeight},f=()=>{let{width:e,height:t}=d(),n=Math.min(e/l,t/u);c.style.setProperty(`--stage-scale`,`${n}`)};window.addEventListener(`resize`,f);var p=()=>{document.body.classList.remove(`is-game-active`),t(c,e=>{e===`start`&&m()})},m=()=>{document.body.classList.add(`is-game-active`),o(c,{onExitToHome:()=>{p()}})};p(),f();